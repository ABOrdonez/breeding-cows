{% extends 'breedingcows/base.html' %}

{% block header %}
    <h4 class="page-title pull-left">Asociar palpitacion</h4>
    <ul class="breadcrumbs pull-left">
        <li><a href="{% url 'breeding_cow_detail' pk=breeding_cow.pk %}">Detalle del Rodeo de Cría</a></li>
        <li><span>Asociar palpitacion</span></li>
    </ul>
{% endblock %}

{% block content %}
	<div class="col-12 mt-3">
		<div class="card">
			<div class="invoice-head">
		        <div class="iv-left col-6 mt-3">
		            <span>Selección de Animales</span>
		        </div>
			</div>
			<div class="modal-body">
			    <div class="row"> 
			      <div class="col-sm-5">
			      	<h4 class="header-title">Animales del Rodeo</h4>
			        <div class="selector-available"> 
			          <select name="all_animals" class="filtered form-control" id="id_all_animals_from" multiple="" data-is-stacked="0" data-field-name="selected_animals">
			            {% for animal in animals %}
					       <option id="{{animal.id}}" value="{{animal.id}}" title="{{animal.flock_number}}">{{animal.flock_number}}</option>
					    {% endfor %}
			          </select>
			        </div>
			      </div>
			      <div class="col-sm-2 text-center">
			        <a onclick="moves_out()">
			        	<i class="fa fa-arrow-left"></i>
			        </a>
			        <a onclick="moves_in()">
			        	<i class="fa fa-arrow-right"></i>
			        </a>
			      </div>

			      <div class="col-sm-5">
			      	<h4 class="header-title">Aplicado en</h4>
			         <div class="selector-chosen">
			            <select id="id_selected_animals_to" multiple="multiple" size="0" name="selected_animals" class="filtered form-control" >
			            </select>
			          </div>
			      </div>
			    </div>
			 </div>
		</div>
	</div>

	<div class="col-12 mt-3">
		<div class="card">
			<div class="invoice-head">
		        <div class="iv-left col-6 mt-3">
		            <span>Resultados del analisis: </span>
		        </div>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="dropdown col-lg-6 col-md-4 col-sm-6">
		                <button class="btn btn-rounded btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
		                    Madurez sexual
		                </button>
		                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="top-start" style="position: absolute; transform: translate3d(15px, -107px, 0px); top: 0px; left: 0px; will-change: transform;">
		                    <a class="dropdown-item" onclick="added_selected_choice(id_maturity,'Aceptable')">Aceptable</a>
		                    <a class="dropdown-item" onclick="added_selected_choice(id_maturity,'No aceptable')">No aceptable</a>
		                </div>
		            </div>
		            <div class="col-sm-6 text-md-right">
		            	<span id="id_maturity" class="h5 text-success"></span>
		            </div>
				</div>
				<div class="row">
					<div class="dropdown col-lg-6 col-md-4 col-sm-6 mt-3">
		                <button class="btn btn-rounded btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
		                    Desarrollo corporal
		                </button>
		                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="top-start" style="position: absolute; transform: translate3d(15px, -107px, 0px); top: 0px; left: 0px; will-change: transform;">
		                    <a class="dropdown-item" onclick="added_selected_choice(id_development,'Aceptable')">Aceptable</a>
		                    <a class="dropdown-item" onclick="added_selected_choice(id_development,'No aceptable')">No aceptable</a>
		                </div>
		            </div>
		            <div class="col-sm-6 text-md-right">
		            	<span id="id_development" class="h5 text-success"></span>
		            </div>
				</div>
				<div class="row">
					<div class="dropdown col-lg-6 col-md-4 col-sm-6 mt-3">
		                <button class="btn btn-rounded btn-light dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
		                    Enfermedades
		                </button>
		                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" x-placement="top-start" style="position: absolute; transform: translate3d(15px, -107px, 0px); top: 0px; left: 0px; will-change: transform;">
		                    <a class="dropdown-item" onclick="added_selected_choice(id_disease,'Contiene')">Conotiene</a>
		                    <a class="dropdown-item" onclick="added_selected_choice(id_disease,'No contiene')">No conotiene</a>
		                </div>
		            </div>
		            <div class="col-sm-6 text-md-right">
		            	<span id="id_disease" class="h5 text-success"></span>
		            </div>
				</div>

				 <button type="submit" name="action" class="btn btn-outline-success btn-lg btn-block mt-3" data-dismiss="modal" onclick="save({{ breeding_cow.pk }})">Guardar</button>
				</div>
		</div>
	</div>

	<script>
      function moves_in(){
        var selected_animlas = $("#id_all_animals_from option:selected");
        var unselected_animlas = $("#id_all_animals_from option:not(:selected)");

        $.each(selected_animlas, function(id, option, title) {
          $("#id_selected_animals_to").append('<option id='+option.id+' value='+option.id+' title='+option.title+'>'+option.title+'</option>');
        });
        $("#id_all_animals_from").empty();
        $.each(unselected_animlas, function(id, option, title) {
          $("#id_all_animals_from").append('<option id='+option.id+' value='+option.id+' title='+option.title+'>'+option.title+'</option>');
        });
      };
    </script>

    <script>
      function moves_out(){
        var selected_animlas = $("#id_selected_animals_to option:selected");
        var unselected_animlas = $("#id_selected_animals_to option:not(:selected)");

        $.each(selected_animlas, function(id, option, title) {
          $("#id_all_animals_from").append('<option id='+option.id+' value='+option.id+' title='+option.title+'>'+option.title+'</option>');
        });
        $("#id_selected_animals_to").empty();
        $.each(unselected_animlas, function(id, option, title) {
          $("#id_selected_animals_to").append('<option id='+option.id+' value='+option.id+' title='+option.title+'>'+option.title+'</option>');
        });
      };
    </script>

	<script>
      function added_selected_choice(idSpam, selectedChoice){
      	$("#"+idSpam.id).text(selectedChoice)
        };
    </script>



    <script>
      function save(breedingCowPk){
        var selected_animlas = $("#id_selected_animals_to option");
        var maturity = $("#id_maturity").text()
 		var development = $("#id_development").text()
 		var disease = $("#id_disease").text()

        $.each(selected_animlas, function(id, option) {
	        added_palpation_animal(breedingCowPk, option.id, development, maturity, disease);
        });
    }
    </script>

    <script>
      function added_palpation_animal(breedingCowPk, idAnimal, development, maturity, disease){
          $.ajax({
            type: 'POST',
            url: '/'+breedingCowPk+'/animals/palpation/new/',
            data: {idAnimal: idAnimal, development: development, maturity:maturity, disease:disease},
            success: function (data) {
            	console.log("success")
            },
            error: function(data) {
            	console.log("error")
            }
          });
        };
    </script>

    
{% endblock %}